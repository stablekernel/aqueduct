language: dart
sudo: required
addons:
  postgresql: "9.4"
services:
  - postgresql
before_script:
  - psql -c 'create database dart_test;' -U postgres
  - psql -c 'create user dart with createdb;' -U postgres
  - psql -c "alter user dart with password 'dart';" -U postgres
  - psql -c 'grant all on database dart_test to dart;' -U postgres
  - pub get
script:
  - pub run test -j 1 -r expanded
  - if [ "$TRAVIS_BRANCH" == "master" ]; then
      pub global activate -sgit https://github.com/stablekernel/codecov_dart.git
      dart_codecov_generator --report-on=lib/ --verbose --no-html
    fi
after_success:
  - if [ "$TRAVIS_BRANCH" == "master" ]; then
      bash <(curl -s https://codecov.io/bash)
    fi
branches:
  only:
    - master
    - 1.0