
<!DOCTYPE html>
<html class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for Aqueduct, a Dart server-side framework.">
      
      
      
      
        <link rel="shortcut icon" href="../../assets/images/favicon.png">
      
      <meta name="generator" content="mkdocs-0.16.1, mkdocs-material-1.1.1">
    
    
      
        <title>1. Getting Started - Aqueduct</title>
      
    
    
      <script src="../../assets/javascripts/modernizr-56ade86843.js"></script>
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application-4ebe3f1d68.css">
      
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../../style/css/override.css">
    
    
  </head>
  
  
  
  
    <body>
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <a href="../.." title="Aqueduct" class="md-icon md-icon--home md-header-nav__button">
          </a>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
                <span class="md-header-nav__parent">
                  Tutorial
                </span>
              
            
            1. Getting Started
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search">
  <div class="md-search__overlay"></div>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" accesskey="s" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result"></div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <div class="md-header-nav__source">
          
            


  


  <a href="https://github.com/stablekernel/aqueduct" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

          
        </div>
      </div>
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    
      <i class="md-icon md-icon--home md-nav__button"></i>
    
    Aqueduct
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/stablekernel/aqueduct" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Tutorial
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Tutorial
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
    <a href="./" title="1. Getting Started" class="md-nav__link md-nav__link--active">
      1. Getting Started
    </a>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../writing-tests/" title="2. Writing Tests" class="md-nav__link">
      2. Writing Tests
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../executing-queries/" title="3. Executing Database Queries" class="md-nav__link">
      3. Executing Database Queries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../model-relationships-and-joins/" title="4. Advanced Database Queries" class="md-nav__link">
      4. Advanced Database Queries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../deploying-and-other-fun-things/" title="5. Deploying" class="md-nav__link">
      5. Deploying
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      HTTP
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        HTTP
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../http/overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../http/structure/" title="Application Structure" class="md-nav__link">
      Application Structure
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../http/request_and_response/" title="Request and Response Objects" class="md-nav__link">
      Request and Response Objects
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../http/request_controller/" title="Handling Requests: Fundamentals" class="md-nav__link">
      Handling Requests: Fundamentals
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../http/routing/" title="Routing" class="md-nav__link">
      Routing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../http/request_sink/" title="Initialization and the RequestSink" class="md-nav__link">
      Initialization and the RequestSink
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../http/http_controller/" title="Handling Requests: HTTPController" class="md-nav__link">
      Handling Requests: HTTPController
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../http/configure/" title="CORS Configuration" class="md-nav__link">
      CORS Configuration
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Database/ORM
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Database/ORM
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../db/overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../db/modeling_data/" title="Modeling Data" class="md-nav__link">
      Modeling Data
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../db/serialization/" title="Storage, Serialization and Deserialization" class="md-nav__link">
      Storage, Serialization and Deserialization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../db/executing_queries/" title="Executing Queries" class="md-nav__link">
      Executing Queries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../db/advanced_queries/" title="Advanced Queries" class="md-nav__link">
      Advanced Queries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../db/validations/" title="Validations" class="md-nav__link">
      Validations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../db/db_tools/" title="Migration and Tooling" class="md-nav__link">
      Migration and Tooling
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../db/inside_the_db/" title="Inside the DB" class="md-nav__link">
      Inside the DB
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      OAuth 2.0
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        OAuth 2.0
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../auth/overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../auth/server/" title="Setting up Authorization" class="md-nav__link">
      Setting up Authorization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../auth/authorizer/" title="Protected Routes" class="md-nav__link">
      Protected Routes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../auth/controllers/" title="Issuing Access Tokens" class="md-nav__link">
      Issuing Access Tokens
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../auth/cli/" title="Creating OAuth 2.0 Clients" class="md-nav__link">
      Creating OAuth 2.0 Clients
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../auth/what_is_oauth/" title="What is OAuth 2.0?" class="md-nav__link">
      What is OAuth 2.0?
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Testing
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Testing
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../testing/overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../testing/harness/" title="Test Harness" class="md-nav__link">
      Test Harness
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../testing/test_client/" title="Writing Tests and the TestClient" class="md-nav__link">
      Writing Tests and the TestClient
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Deployment
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Deployment
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../deploy/overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../deploy/deploy_local/" title="Deploy Locally" class="md-nav__link">
      Deploy Locally
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../deploy/deploy_heroku/" title="Deploy on Heroku" class="md-nav__link">
      Deploy on Heroku
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../deploy/deploy_aws/" title="Deploy on AWS" class="md-nav__link">
      Deploy on AWS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../deploy/script/" title="Deploying without aqueduct serve" class="md-nav__link">
      Deploying without aqueduct serve
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#purpose" title="Purpose" class="md-nav__link">
    Purpose
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installing-dart" title="Installing Dart" class="md-nav__link">
    Installing Dart
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-a-project" title="Creating a Project" class="md-nav__link">
    Creating a Project
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#handling-requests" title="Handling Requests" class="md-nav__link">
    Handling Requests
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#routing-and-another-route" title="Routing and Another Route" class="md-nav__link">
    Routing and Another Route
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-more-you-know-multi-threading-and-application-state" title="The More You Know: Multi-threading and Application State" class="md-nav__link">
    The More You Know: Multi-threading and Application State
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-chapter-writing-tests" title="Next Chapter: Writing Tests" class="md-nav__link">
    Next Chapter: Writing Tests
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
               
                 <a href="https://github.com/stablekernel/aqueduct/edit/master/docs/tut/getting-started.md" title="Edit this page" class="md-icon md-content__edit">edit</a>
               
              
                
                  <h1>1. Getting Started</h1>
                
                <h2 id="purpose">Purpose</h2>
<p>The purpose of this tutorial series is to become familiar with how Aqueduct works. That means this tutorial will take a less efficient approach than a normal work flow so that the fundamentals are covered. For example, you will create a new project manually, but in a real work flow you would use the <code>aqueduct</code> command line tool.</p>
<p>This tutorial will use Atom for editing code. It has the lowest barrier to entry and is easy to install. For heavy duty work, we recommend IntelliJ IDEA Community Edition with the Dart plugin. The IntelliJ Dart plugin is an official plugin.</p>
<h2 id="installing-dart">Installing Dart</h2>
<p>If you have Homebrew installed, run these commands from terminal:</p>
<div class="codehilite"><pre><span></span>brew tap dart-lang/dart
brew install dart
</pre></div>


<p>If you don't have Homebrew installed or you are on another platform, visit <a href="https://www.dartlang.org/install">https://www.dartlang.org/install</a>. It'll be quick, promise.</p>
<p>You should install Atom for editing your Dart code. You can get it from <a href="https://atom.io">https://atom.io</a>. Once Atom is installed, install the 'dartlang' package from 'dart-atom' (not any of the other ones that have a similar name).  </p>
<h2 id="creating-a-project">Creating a Project</h2>
<p>Create a new directory named <code>quiz</code> (ensure that it is lowercase). In this directory, create a new file named <code>pubspec.yaml</code>. Dart uses this file to define your project and its dependencies (like iOS' <code>Info.plist</code> or Android's <code>AndroidManifest.xml</code>).</p>
<p>In the pubspec, enter the following markup:</p>
<div class="codehilite"><pre><span></span><span class="n">name</span><span class="o">:</span> <span class="n">quiz</span>
<span class="n">description</span><span class="o">:</span> <span class="n">A</span> <span class="n">quiz</span> <span class="n">web</span> <span class="n">server</span>
<span class="n">version</span><span class="o">:</span> <span class="mf">0.0</span><span class="o">.</span><span class="mi">1</span>
<span class="n">author</span><span class="o">:</span> <span class="n">Thor</span> <span class="n">Odinson</span> <span class="o">&lt;</span><span class="n">thor</span><span class="err">@</span><span class="n">asgard</span><span class="o">.</span><span class="na">yg</span><span class="o">&gt;</span>

<span class="n">environment</span><span class="o">:</span>
  <span class="n">sdk</span><span class="o">:</span> <span class="s1">&#39;&gt;=1.20.0 &lt;2.0.0&#39;</span>

<span class="n">dependencies</span><span class="o">:</span>
  <span class="n">aqueduct</span><span class="o">:</span> <span class="n">any</span>  
</pre></div>


<p>This pubspec declares an application named <code>quiz</code> (all Dart files, directories and application identifiers are snake_case), indicates that it can use a version of the Dart SDK between 1.20 and 2.0, and depends on the <code>aqueduct</code> package.</p>
<p>Next, you will fetch the dependencies of the <code>quiz</code> project - this will fetch the source for <code>aqueduct</code> from Dart's hosted package manager. If you are using Atom, you'll get a popup that tells you to do this and you can just click the button. (You may also right-click on file in Atom and select 'Pub Get'). If you aren't using Atom, from the command line, run the following from inside the <code>quiz</code> directory:</p>
<div class="codehilite"><pre><span></span>pub get
</pre></div>


<p>Dependencies get stored in the global cache directory, <code>~/.pub-cache</code>. Dependencies are referenced by files in your project's directory. These files are automatically generated by the previous command. You won't have to worry about that, though, since you'll never have to deal with it directly. Sometimes, it's just nice to know where things are. (There is one other file, called <code>pubspec.lock</code> that you do care about, but we'll chat about it later.)</p>
<p>With this dependency installed, your project can use Aqueduct. For this simple getting started guide, we won't structure a full project and just focus on getting an Aqueduct web server up and running. Create a new directory named <code>lib</code> and add a file to it named <code>quiz.dart</code>. The project should now look like this on the filesystem:</p>
<div class="codehilite"><pre><span></span>quiz/
  pubspec.yaml
  pubspec.lock
  lib/
    quiz.dart
</pre></div>


<p>At the top of this file, import the Aqueduct package and the <code>async</code> standard library:</p>
<div class="codehilite"><pre><span></span><span class="k">import</span> <span class="s1">&#39;dart:async&#39;</span><span class="p">;</span>

<span class="k">import</span> <span class="s1">&#39;package:aqueduct/aqueduct.dart&#39;</span><span class="p">;</span>
</pre></div>


<h2 id="handling-requests">Handling Requests</h2>
<p>The structure of Aqueduct is like most server-side frameworks: a new request comes in and gets routed to code that will respond to it. At its core, Aqueduct request handling is made up of three types of objects: <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/Request-class.html">Request</a>s, <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/Response-class.html">Response</a>s and <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/RequestController-class.html">RequestController</a>s. When an Aqueduct application receives an HTTP request, it creates a <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/Request-class.html">Request</a> object. For every <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/Request-class.html">Request</a>, a <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/Response-class.html">Response</a> must be created and sent back. <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/RequestController-class.html">RequestController</a>s handle the logic of taking a <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/Request-class.html">Request</a>s and creating a <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/Response-class.html">Response</a>s.</p>
<p>Examples of <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/RequestController-class.html">RequestController</a> subclasses are <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/Router-class.html">Router</a> and <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/HTTPController-class.html">HTTPController</a>. A router figures out the right <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/RequestController-class.html">RequestController</a> to handle a request by inspecting the request's path. An <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/HTTPController-class.html">HTTPController</a> takes a request - after it's been through a <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/Router-class.html">Router</a> - and calls one its methods depending on the request's HTTP method (e.g., GET, POST). That method returns a <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/Response-class.html">Response</a> and the request is completed.</p>
<p>The <code>quiz</code> application will have a <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/Router-class.html">Router</a> that will send requests with the path <code>/questions</code> to an instance of <code>QuestionController</code>. <code>QuestionController</code> is an <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/HTTPController-class.html">HTTPController</a> subclass that you will write - it will respond with a list of JSON questions. In <code>quiz.dart</code>, create this new type:</p>
<div class="codehilite"><pre><span></span><span class="kd">class</span> <span class="nc">QuestionController</span> <span class="kd">extends</span> <span class="n">HTTPController</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="n">questions</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;How much wood can a woodchuck chuck?&quot;</span><span class="p">,</span>
    <span class="s2">&quot;What&#39;s the tallest mountain in the world?&quot;</span>
  <span class="p">];</span>

  <span class="err">@</span><span class="n">httpGet</span>
  <span class="n">Future</span><span class="o">&lt;</span><span class="n">Response</span><span class="o">&gt;</span> <span class="n">getAllQuestions</span><span class="p">()</span> <span class="kd">async</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">Response</span><span class="p">.</span><span class="n">ok</span><span class="p">(</span><span class="n">questions</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>The <code>QuestionController</code> class has a list of strings named <code>questions</code> and a method called <code>getAllQuestions</code>. The metadata above the method - <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/httpGet-constant.html">httpGet</a> - is important. This metadata tells the <code>QuestionController</code> to invoke <code>getAllQuestions</code> when it receives a GET request. Likewise, if this metadata were <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/httpPut-constant.html">httpPut</a> or <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/httpPost-constant.html">httpPost</a>, this controller would invoke this method for PUT or POST requests.</p>
<p>Methods declared in <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/HTTPController-class.html">HTTPController</a> subclasses with this metadata are called <em>responder methods</em>, because they respond to HTTP requests. This is the primary job of an <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/HTTPController-class.html">HTTPController</a> - to map requests to a responder method based on their HTTP method. A responder method must return an instance of <code>Future&lt;Response&gt;</code>. There are convenience constructors for common response status codes. In this example, <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/Response/Response.ok.html">Response.ok</a> creates a <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/Response-class.html">Response</a> with status code 200. The first argument to <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/Response/Response.ok.html">Response.ok</a> is an object that will be encoded as the HTTP response body.</p>
<p>Now, we must create a <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/Router-class.html">Router</a>. A <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/Router-class.html">Router</a> will receive all requests in an application. During initialization, a router is given <em>routes</em> - patterns that look for matches in the path of an HTTP request - and <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/RequestController-class.html">RequestController</a>s registered to receive requests for those routes. In your application, the <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/Router-class.html">Router</a> will have instances of <code>QuestionController</code> registered for the route <code>/questions</code>. All initialization for Aqueduct applications happens in a <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/RequestSink-class.html">RequestSink</a>.</p>
<p>An application subclasses <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/RequestSink-class.html">RequestSink</a> and overrides a few of methods to handle initializing the application. The one required override is <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/RequestSink/setupRouter.html">setupRouter</a>. This method, as the name suggests, is where you set up the application's routes and <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/RequestController-class.html">RequestController</a>s. The tools that run an Aqueduct application know how to find and create your <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/RequestSink-class.html">RequestSink</a> subclass in your application.</p>
<p>At the bottom of <code>quiz.dart</code>, create a <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/RequestSink-class.html">RequestSink</a> subclass:</p>
<div class="codehilite"><pre><span></span><span class="kd">class</span> <span class="nc">QuizRequestSink</span> <span class="kd">extends</span> <span class="n">RequestSink</span> <span class="p">{</span>
  <span class="n">QuizRequestSink</span><span class="p">(</span><span class="n">ApplicationConfiguration</span> <span class="n">options</span><span class="p">)</span> <span class="o">:</span> <span class="k">super</span> <span class="p">(</span><span class="n">options</span><span class="p">);</span>

  <span class="err">@</span><span class="n">override</span>
  <span class="kt">void</span> <span class="n">setupRouter</span><span class="p">(</span><span class="n">Router</span> <span class="n">router</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">router</span>
      <span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/questions&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="n">generate</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="n">QuestionController</span><span class="p">());</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>A <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/RequestSink-class.html">RequestSink</a> subclass must have a constructor that takes an <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/ApplicationConfiguration-class.html">ApplicationConfiguration</a> instance and forward it on to its superclass' constructor. These values are provided by a configuration file and are typically used to configure a <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/RequestSink-class.html">RequestSink</a>'s properties - like a database connection. Since the <code>quiz</code> app doesn't do much right now, we simply forward the configuration options on to the <code>super</code>'s constructor as required.</p>
<p>Routes are registered through the <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/Router/route.html">route</a> method. When a router matches the path of an HTTP request to one of its registered routes, the <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/Request-class.html">Request</a> is sent to the next <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/RequestController-class.html">RequestController</a> for that route. If no registered route matches the path of the request, the <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/Router-class.html">Router</a> responds to the <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/Request-class.html">Request</a> with a 404 status code and drops the <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/Request-class.html">Request</a> event.</p>
<p>In this example, the "next controller" for <code>/questions</code> is added with the <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/RequestController/generate.html">generate</a> method. The <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/RequestController/generate.html">generate</a> method takes a closure that returns an instance of some <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/RequestController-class.html">RequestController</a>. Each time the router passes a <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/Request-class.html">Request</a> a generator, the closure is called, creating a new instance of that <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/RequestController-class.html">RequestController</a>, and the <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/Request-class.html">Request</a> is delivered to that new instance. Here, that new instance is an instance of our <code>QuestionController</code>.</p>
<p>We'll get to the specifics of all of that in a moment, but we're at the point that we can run this web server, and that seems more exciting. First, activate the <code>aqueduct</code> executable:</p>
<div class="codehilite"><pre><span></span>pub global activate aqueduct
</pre></div>


<p>This command might tell you that <code>~/.pub-cache/bin</code> (or some other directory) is not in your <code>PATH</code> variable. If that's the case, add it according to the instructions emitted by the command. (For example, if you are on macOS, you'd add <code>export PATH=$PATH:"~/pub-cache/bin"</code> to your <code>~/.bash_profile</code> and then reload your terminal.)</p>
<p>In the project directory, run the following command to start the application:</p>
<div class="codehilite"><pre><span></span>aqueduct serve
</pre></div>


<p>In a browser, open the URL <code>http://localhost:8081/questions</code>. You'll see the list of questions! (You can shut down the server by hitting Ctrl-C in the terminal where you ran <code>aqueduct serve</code>.)</p>
<h2 id="routing-and-another-route">Routing and Another Route</h2>
<p>So far, we've added a route that matches the constant string <code>/questions</code>. Routers can do more than match a constant string, they can also include path variables, optional path components, regular expression matching and the wildcard character. We'll add to the existing <code>/questions</code> route by allowing requests to get a specific question.</p>
<p>In <code>quiz.dart</code>, modify the code in the <code>QuizRequestSink.setupRouter</code> by adding "/[:index]" to the route.</p>
<div class="codehilite"><pre><span></span>  <span class="err">@</span><span class="n">override</span>
  <span class="kt">void</span> <span class="n">setupRouter</span><span class="p">(</span><span class="n">Router</span> <span class="n">router</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">router</span>
        <span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/questions/[:index]&quot;</span><span class="p">)</span>
        <span class="p">.</span><span class="n">generate</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="n">QuestionController</span><span class="p">());</span>
  <span class="p">}</span>
</pre></div>


<p>The square brackets indicate that part of the path is optional, and the colon indicates that it is a path variable. A path variable matches anything. Therefore, this route will match if the path is <code>/questions</code> or <code>/questions/2</code> or <code>/questions/foo</code>.</p>
<p>When using path variables, you may optionally restrict which values they match with a regular expression. The regular expression syntax goes into parentheses after the path variable name. Let's restrict the <code>index</code> path variable to only numbers:</p>
<div class="codehilite"><pre><span></span>  <span class="err">@</span><span class="n">override</span>
  <span class="kt">void</span> <span class="n">setupRouter</span><span class="p">(</span><span class="n">Router</span> <span class="n">router</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">router</span>
        <span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/questions/[:index(</span><span class="se">\\</span><span class="s2">d+)]&quot;</span><span class="p">)</span>
        <span class="p">.</span><span class="n">generate</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="n">QuestionController</span><span class="p">());</span>
  <span class="p">}</span>
</pre></div>


<p>Now, there are two types of requests that will get forwarded to a <code>QuestionController</code> - a request for all questions (<code>/questions</code>) and and a request for a specific question at some index (<code>/questions/1</code>). We need to add a new responder method to <code>QuestionController</code> that gets called when the latter request is made:</p>
<div class="codehilite"><pre><span></span><span class="kd">class</span> <span class="nc">QuestionController</span> <span class="kd">extends</span> <span class="n">HTTPController</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="n">questions</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;How much wood can a woodchuck chuck?&quot;</span><span class="p">,</span>
    <span class="s2">&quot;What&#39;s the tallest mountain in the world?&quot;</span>
  <span class="p">];</span>

  <span class="err">@</span><span class="n">httpGet</span>
  <span class="n">Future</span><span class="o">&lt;</span><span class="n">Response</span><span class="o">&gt;</span> <span class="n">getAllQuestions</span><span class="p">()</span> <span class="kd">async</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">Response</span><span class="p">.</span><span class="n">ok</span><span class="p">(</span><span class="n">questions</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="err">@</span><span class="n">httpGet</span>
  <span class="n">Future</span><span class="o">&lt;</span><span class="n">Response</span><span class="o">&gt;</span> <span class="n">getQuestionAtIndex</span><span class="p">(</span><span class="err">@</span><span class="n">HTTPPath</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">)</span> <span class="kt">int</span> <span class="n">index</span><span class="p">)</span> <span class="kd">async</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="o">&lt;</span> <span class="m">0</span> <span class="o">||</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="n">questions</span><span class="p">.</span><span class="n">length</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="n">Response</span><span class="p">.</span><span class="n">notFound</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="k">new</span> <span class="n">Response</span><span class="p">.</span><span class="n">ok</span><span class="p">(</span><span class="n">questions</span><span class="p">[</span><span class="n">index</span><span class="p">]);</span>  
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>Reload the application by hitting Ctrl-C and then running <code>aqueduct serve</code> again. In your browser, enter <code>http://localhost:8081/questions</code> and you'll get the list of questions. Then, enter <code>http://localhost:8081/questions/0</code> and you'll get the first question. If you enter an index not within the list of questions or something other than an integer, you'll get a 404.</p>
<p>When a <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/Request-class.html">Request</a> is sent to an <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/HTTPController-class.html">HTTPController</a>, it evaluates the HTTP method of the request and matches it against every declared responder method. In this case, the <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/HTTPController-class.html">HTTPController</a> will have two possible choices: <code>getQuestions</code> and <code>getQuestionAtIndex</code>. From here, it looks at the parameters for each of the methods and the path variables in the <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/Request-class.html">Request</a>.</p>
<p>Parameters with <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/HTTPPath-class.html">HTTPPath</a> metadata are used to match path variables from the <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/Request-class.html">Request</a>. If there are no path variables, the no-argument <code>getAllQuestions</code> is invoked. If there is one <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/HTTPPath-class.html">HTTPPath</a> argument <em>and</em> the name of the path variable is named <code>index</code> (the <code>String</code> argument to <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/HTTPPath-class.html">HTTPPath</a>), then <code>getQuestionAtIndex</code> is called. The name of the path variable is defined by the name of the variable declared in <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/Router-class.html">Router</a>'s <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/Router/route.html">route</a> method.</p>
<p>If neither of those scenarios are true, the <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/HTTPController-class.html">HTTPController</a> responds with 404 and doesn't call any of your responder methods. Because the route is declared to also evaluate a regular expression that restricts <code>index</code> to only numeric values, non-numeric values in the <code>index</code> portion of the route will also yield a 404. You can try that be hitting <code>http://localhost:8081/questions/foo</code> from your browser.</p>
<p>This HTTP method and path variable matching behavior is specific to <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/HTTPController-class.html">HTTPController</a>.</p>
<h2 id="the-more-you-know-multi-threading-and-application-state">The More You Know: Multi-threading and Application State</h2>
<p>In this simple exercise, we used a constant list of question as the source of data for the questions endpoint. For a simple getting-your-feet-wet demo, this is fine.</p>
<p>However, in a real application, it is important that we don't keep any mutable state in a <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/RequestSink-class.html">RequestSink</a> or any <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/RequestController-class.html">RequestController</a>s. This is for three reasons. First, it's just bad practice - web servers should be stateless. They are facilitators between a client and a repository of data, not a repository of data themselves. A repository of data is typically a database.</p>
<p>Second, the way Aqueduct applications are structured makes it really difficult to keep state. For example, <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/HTTPController-class.html">HTTPController</a> is instantiated each time a new request comes in. Any state they have is discarded after the request is finished processing. This is intentional - you won't run into an issue when scaling to multiple server instances in the future, because the code is already structured to be stateless.</p>
<p>Finally, isolates. Aqueduct applications are set up to run on multiple isolates (the <code>--isolates</code> option for the in <code>aqueduct serve</code>). An isolate is effectively a thread that shares no memory with other threads. If we were to keep track of state in some way, that state would not be reflected across all of the isolates running on this web server. So depending on which isolate grabbed a request, it may have different state than you might expect. Again, Aqueduct forces you into this model on purpose.</p>
<p>Isolates will spread themselves out across CPUs on the host machine. Each isolate will have its own instance of your <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/RequestSink-class.html">RequestSink</a> subclass. Having multiple isolates running the same stateless web server on one machine allows for faster request handling. Each isolate also maintains its own set of resources, like database connections.</p>
<h2 id="next-chapter-writing-tests"><a href="../writing-tests/">Next Chapter: Writing Tests</a></h2>
              
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../.." title="Home" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Home
              </span>
            </div>
          </a>
        
        
          <a href="../writing-tests/" title="2. Writing Tests" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                2. Writing Tests
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Built by stable|kernel
          </div>
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application-30ac6a1727.js"></script>
      <script>app.initialize({url:{base:"../.."}})</script>
      
    
    
      
      <script>!function(e,t,a,n,o,c,i){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,c=t.createElement(a),i=t.getElementsByTagName(a)[0],c.async=1,c.src=n,i.parentNode.insertBefore(c,i)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-41269877-2","aqueduct.io"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var t=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",t,e.href)})});var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})</script>
      
    
  </body>
</html>