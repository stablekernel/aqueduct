
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for Aqueduct, a Dart server-side framework.">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.0.6">
    
    
      
        <title>Serializing Request and Response Bodies - Aqueduct</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.2c0c5eaf.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.7fa14f5b.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="../../style/css/override.css">
    
    
      
        
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-41269877-2","aqueduct.io"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){var e;this.value&&(e=document.location.pathname,ga("send","pageview",e+"?q="+this.value))}),"undefined"!=typeof location$&&location$.subscribe(function(e){ga("send","pageview",e.pathname)})})</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#serializing-request-and-response-bodies" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
        <aside class="md-announce">
          <div class="md-announce__inner md-grid md-typeset">
            
We've made the difficult decision to no longer support Aqueduct. Read the why behind our decision and how the sunsetting of Aqueduct might impact your projects
<a href="https://stablekernel.com/article/announcing-the-sunsetting-of-aqueduct-our-open-source-server-side-framework-in-googles-dart/">here</a>.

          </div>
        </aside>
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Aqueduct" class="md-header__button md-logo" aria-label="Aqueduct" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Aqueduct
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Serializing Request and Response Bodies
            
          </span>
        </div>
      </div>
    </div>
    <div class="md-header__options">
      
    </div>
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/stablekernel/aqueduct/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Aqueduct" class="md-nav__button md-logo" aria-label="Aqueduct" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Aqueduct
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/stablekernel/aqueduct/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../core_concepts/" class="md-nav__link">
        Core Concepts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../tour/" class="md-nav__link">
        Tour
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../best_practices/" class="md-nav__link">
        Best Practices
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../intellij/" class="md-nav__link">
        IntelliJ IDEA Templates
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      <label class="md-nav__link" for="__nav_7">
        Tutorial
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Tutorial" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Tutorial
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tut/getting-started/" class="md-nav__link">
        1. Getting Started
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tut/executing-queries/" class="md-nav__link">
        2. Reading from a Database
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tut/storing-data/" class="md-nav__link">
        3. Storing Data in a Database
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tut/writing-tests/" class="md-nav__link">
        4. Configuration and Testing
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tut/oauth2/" class="md-nav__link">
        5. Authentication and Authorization
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      <label class="md-nav__link" for="__nav_8">
        Snippets
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Snippets" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Snippets
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../snippets/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../snippets/http/" class="md-nav__link">
        HTTP
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../snippets/orm/" class="md-nav__link">
        ORM
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../snippets/auth/" class="md-nav__link">
        Authentication and Authorization
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../snippets/test/" class="md-nav__link">
        Testing
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9" type="checkbox" id="__nav_9" >
      
      <label class="md-nav__link" for="__nav_9">
        Guide: Application Configuration and Behavior
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Guide: Application Configuration and Behavior" data-md-level="1">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          Guide: Application Configuration and Behavior
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../application/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../application/channel/" class="md-nav__link">
        Starting and Stopping Applications
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../application/configure/" class="md-nav__link">
        Configuring an Application and its Environment
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../application/structure/" class="md-nav__link">
        Application and Project Structure
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../application/threading/" class="md-nav__link">
        Multi-threading
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_10" type="checkbox" id="__nav_10" checked>
      
      <label class="md-nav__link" for="__nav_10">
        Guide: Handling HTTP Requests
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Guide: Handling HTTP Requests" data-md-level="1">
        <label class="md-nav__title" for="__nav_10">
          <span class="md-nav__icon md-icon"></span>
          Guide: Handling HTTP Requests
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../controller/" class="md-nav__link">
        Handling Requests and Sending Response
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Serializing Request and Response Bodies
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Serializing Request and Response Bodies
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-request-object" class="md-nav__link">
    The Request Object
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-response-object" class="md-nav__link">
    The Response Object
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#encoding-and-decoding-the-http-body" class="md-nav__link">
    Encoding and Decoding the HTTP Body
  </a>
  
    <nav class="md-nav" aria-label="Encoding and Decoding the HTTP Body">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#decoding-request-bodies" class="md-nav__link">
    Decoding Request Bodies
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoding-response-body-objects" class="md-nav__link">
    Encoding Response Body Objects
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#streaming-response-bodies" class="md-nav__link">
    Streaming Response Bodies
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#codecs-and-content-types" class="md-nav__link">
    Codecs and Content Types
  </a>
  
    <nav class="md-nav" aria-label="Codecs and Content Types">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#compression-with-gzip" class="md-nav__link">
    Compression with gzip
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#serializable-objects" class="md-nav__link">
    Serializable Objects
  </a>
  
    <nav class="md-nav" aria-label="Serializable Objects">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sending-serializable-objects-as-response-bodies" class="md-nav__link">
    Sending Serializable Objects as Response Bodies
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reading-serializable-objects-from-request-bodies" class="md-nav__link">
    Reading Serializable Objects from Request Bodies
  </a>
  
    <nav class="md-nav" aria-label="Reading Serializable Objects from Request Bodies">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#key-filtering" class="md-nav__link">
    Key Filtering
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#subclassing-serializable" class="md-nav__link">
    Subclassing Serializable
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#serializable-and-openapi-generation" class="md-nav__link">
    Serializable and OpenAPI Generation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../routing/" class="md-nav__link">
        Routing
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../resource_controller/" class="md-nav__link">
        Request Binding with Resource Controllers
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../serving_files/" class="md-nav__link">
        Serving Files and Caching
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../websockets/" class="md-nav__link">
        Websockets
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../file_upload/" class="md-nav__link">
        Uploading Files
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_11" type="checkbox" id="__nav_11" >
      
      <label class="md-nav__link" for="__nav_11">
        Guide: Databases and ORM
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Guide: Databases and ORM" data-md-level="1">
        <label class="md-nav__title" for="__nav_11">
          <span class="md-nav__icon md-icon"></span>
          Guide: Databases and ORM
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../db/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../db/connecting/" class="md-nav__link">
        Connecting to a Database
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../db/modeling_data/" class="md-nav__link">
        Modeling Data and Relationships
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../db/serialization/" class="md-nav__link">
        Serialization and Deserialization
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../db/executing_queries/" class="md-nav__link">
        Basic Queries
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../db/advanced_queries/" class="md-nav__link">
        Advanced Queries
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../db/transactions/" class="md-nav__link">
        Transactions
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../db/validations/" class="md-nav__link">
        Validations
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../db/db_tools/" class="md-nav__link">
        Migration and Tooling
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../db/json_columns/" class="md-nav__link">
        JSON Document Storage
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_12" type="checkbox" id="__nav_12" >
      
      <label class="md-nav__link" for="__nav_12">
        Guide: Authorization and OAuth 2.0
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Guide: Authorization and OAuth 2.0" data-md-level="1">
        <label class="md-nav__title" for="__nav_12">
          <span class="md-nav__icon md-icon"></span>
          Guide: Authorization and OAuth 2.0
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../auth/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../auth/server/" class="md-nav__link">
        Setting up Authorization
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../auth/authorizer/" class="md-nav__link">
        Protecting Routes
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../auth/controllers/" class="md-nav__link">
        Issuing Access Tokens
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../auth/cli/" class="md-nav__link">
        Managing OAuth 2.0 Clients
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../auth/auth_scopes/" class="md-nav__link">
        OAuth 2.0 Scoping
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../auth/what_is_oauth/" class="md-nav__link">
        What is OAuth 2.0?
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_13" type="checkbox" id="__nav_13" >
      
      <label class="md-nav__link" for="__nav_13">
        Guide: Development and Testing
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Guide: Development and Testing" data-md-level="1">
        <label class="md-nav__title" for="__nav_13">
          <span class="md-nav__icon md-icon"></span>
          Guide: Development and Testing
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../testing/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../testing/tests/" class="md-nav__link">
        Writing Tests
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../testing/mixins/" class="md-nav__link">
        Testing with the ORM and OAuth 2.0
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../testing/debugger/" class="md-nav__link">
        Using the Debugger
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../testing/clients/" class="md-nav__link">
        Developing Client Applications
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../testing/mock/" class="md-nav__link">
        Mocking Services
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_14" type="checkbox" id="__nav_14" >
      
      <label class="md-nav__link" for="__nav_14">
        Guide: OpenAPI Documentation
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Guide: OpenAPI Documentation" data-md-level="1">
        <label class="md-nav__title" for="__nav_14">
          <span class="md-nav__icon md-icon"></span>
          Guide: OpenAPI Documentation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../openapi/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../openapi/cli/" class="md-nav__link">
        Creating an OpenAPI Document
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../openapi/components/" class="md-nav__link">
        Documenting Components
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../openapi/endpoint/" class="md-nav__link">
        Documenting Endpoint Controllers
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../openapi/middleware/" class="md-nav__link">
        Documenting Middleware Controllers
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_15" type="checkbox" id="__nav_15" >
      
      <label class="md-nav__link" for="__nav_15">
        Guide: Command-line Tooling
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Guide: Command-line Tooling" data-md-level="1">
        <label class="md-nav__title" for="__nav_15">
          <span class="md-nav__icon md-icon"></span>
          Guide: Command-line Tooling
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../cli/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../cli/create/" class="md-nav__link">
        Creating Applications
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../cli/running/" class="md-nav__link">
        Running Applications
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../cli/document/" class="md-nav__link">
        Generating an OpenAPI/Swagger Specification
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_16" type="checkbox" id="__nav_16" >
      
      <label class="md-nav__link" for="__nav_16">
        Guide: Deployment
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Guide: Deployment" data-md-level="1">
        <label class="md-nav__title" for="__nav_16">
          <span class="md-nav__icon md-icon"></span>
          Guide: Deployment
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../deploy/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../deploy/build/" class="md-nav__link">
        Creating an Aqueduct Executable
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../deploy/deploy_local/" class="md-nav__link">
        Deploy Locally (VM)
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../deploy/deploy_docker/" class="md-nav__link">
        Deploying with Docker and Kubernetes (VM)
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../deploy/deploy_heroku/" class="md-nav__link">
        Deploy on Heroku (VM)
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../deploy/deploy_aws/" class="md-nav__link">
        Deploy on AWS (VM)
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../deploy/script/" class="md-nav__link">
        Deploying without aqueduct serve (VM)
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-request-object" class="md-nav__link">
    The Request Object
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-response-object" class="md-nav__link">
    The Response Object
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#encoding-and-decoding-the-http-body" class="md-nav__link">
    Encoding and Decoding the HTTP Body
  </a>
  
    <nav class="md-nav" aria-label="Encoding and Decoding the HTTP Body">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#decoding-request-bodies" class="md-nav__link">
    Decoding Request Bodies
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoding-response-body-objects" class="md-nav__link">
    Encoding Response Body Objects
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#streaming-response-bodies" class="md-nav__link">
    Streaming Response Bodies
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#codecs-and-content-types" class="md-nav__link">
    Codecs and Content Types
  </a>
  
    <nav class="md-nav" aria-label="Codecs and Content Types">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#compression-with-gzip" class="md-nav__link">
    Compression with gzip
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#serializable-objects" class="md-nav__link">
    Serializable Objects
  </a>
  
    <nav class="md-nav" aria-label="Serializable Objects">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sending-serializable-objects-as-response-bodies" class="md-nav__link">
    Sending Serializable Objects as Response Bodies
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reading-serializable-objects-from-request-bodies" class="md-nav__link">
    Reading Serializable Objects from Request Bodies
  </a>
  
    <nav class="md-nav" aria-label="Reading Serializable Objects from Request Bodies">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#key-filtering" class="md-nav__link">
    Key Filtering
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#subclassing-serializable" class="md-nav__link">
    Subclassing Serializable
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#serializable-and-openapi-generation" class="md-nav__link">
    Serializable and OpenAPI Generation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/stablekernel/aqueduct/edit/docs/source/source/docs/http/request_and_response.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="serializing-request-and-response-bodies">Serializing Request and Response Bodies</h1>
<p>In Aqueduct, HTTP requests and responses are instances of <code>Request</code>s and <code>Response</code>s. For each HTTP request an application receives, an instance of <code>Request</code> is created. A <code>Response</code> must be created for each request. Responses are created by <a href="../controller/">controller objects</a>. This guide discusses the behavior of request and response objects.</p>
<h2 id="the-request-object">The Request Object</h2>
<p>A <code>Request</code> is created for each HTTP request to your application. A <code>Request</code> stores everything about the HTTP request and has some additional behavior that makes reading from them easier. You handle requests by writing code in a <a href="../controller/">controller object</a> or closures.</p>
<p>All properties of a request are available in its <code>raw</code> property (a Dart standard library <code>HttpRequest</code>). A <code>Request</code> has <code>attachments</code> that data can be attached to in a controller for use by a linked controller:</p>
<div class="codehilite"><pre><span></span><code><span class="n">router</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/path&quot;</span><span class="p">).</span><span class="n">linkFunction</span><span class="p">((</span><span class="n">req</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">req</span><span class="p">.</span><span class="n">attachments</span><span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;value&quot;</span><span class="p">;</span>
<span class="p">}).</span><span class="n">linkFunction</span><span class="p">((</span><span class="n">req</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">Response</span><span class="p">.</span><span class="n">ok</span><span class="p">({</span><span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="n">req</span><span class="p">.</span><span class="n">attachments</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]});</span>
<span class="p">});</span>
</code></pre></div>

<p>A <code>Request</code> also has two built-in attachments, <code>authorization</code> and <code>path</code>. <code>authorization</code> contains authorization information from an <code>Authorizer</code> and <code>path</code> has request path information from a <code>Router</code>.</p>
<h2 id="the-response-object">The Response Object</h2>
<p>An <code>Response</code> has a status code, headers and body. The default constructor takes a status code, header map and body object. There are many named constructors for common response types:</p>
<div class="codehilite"><pre><span></span><code><span class="n">Response</span><span class="p">(</span><span class="m">200</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;x-header&quot;</span><span class="o">:</span> <span class="s2">&quot;value&quot;</span><span class="p">},</span> <span class="nl">body:</span> <span class="p">[</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">]);</span>
<span class="n">Response</span><span class="p">.</span><span class="n">ok</span><span class="p">({</span><span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;value&quot;</span><span class="p">});</span>
<span class="n">Response</span><span class="p">.</span><span class="n">created</span><span class="p">();</span>
<span class="n">Response</span><span class="p">.</span><span class="n">badRequest</span><span class="p">(</span><span class="nl">body:</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="o">:</span> <span class="s2">&quot;reason&quot;</span><span class="p">});</span>
</code></pre></div>

<p>Headers are encoded according to <a href="https://api.dartlang.org/stable/2.0.0/dart-io/HttpHeaders/add.html">dart:io.HttpHeaders.add</a>. For body encoding behavior, see the following sections.</p>
<h2 id="encoding-and-decoding-the-http-body">Encoding and Decoding the HTTP Body</h2>
<p><code>Request</code> and <code>Response</code> objects have behavior for handling the HTTP body. You decode the contents of a <code>Request</code> body into Dart objects that are used in your code. You provide a Dart object to a <code>Response</code> and it is automatically encoded according to the content-type of the response.</p>
<h3 id="decoding-request-bodies">Decoding Request Bodies</h3>
<p>Every <code>Request</code> has a <code>body</code> property. This object decodes the bytes from the request body into Dart objects. The behavior for decoding is determined by the content-type header of the request (see the section on <code>CodecRegistry</code> later in this guide). When you decode a body, you can specify the Dart object type you expect it to be. If the decoded body object is not the expected type, an exception that sends a 400 Bad Request error is thrown.</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Ensures that the decoded body is a Map&lt;String, dynamic&gt;</span>
<span class="kd">final</span> <span class="n">map</span> <span class="o">=</span> <span class="kd">await</span> <span class="n">request</span><span class="p">.</span><span class="n">body</span><span class="p">.</span><span class="n">decode</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span> <span class="kt">dynamic</span><span class="o">&gt;&gt;</span><span class="p">();</span>

<span class="c1">// Takes whatever object the body is decoded into</span>
<span class="kd">final</span> <span class="n">anyObject</span> <span class="o">=</span> <span class="kd">await</span> <span class="n">request</span><span class="p">.</span><span class="n">body</span><span class="p">.</span><span class="n">decode</span><span class="p">();</span>
</code></pre></div>

<p>Once a request's body has been decoded, it can be accessed through a synchronous <code>as</code> method. This method also takes a type argument to enforce the type of the decoded body object.</p>
<div class="codehilite"><pre><span></span><code><span class="kd">final</span> <span class="n">map</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">body</span><span class="p">.</span><span class="k">as</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span> <span class="kt">dynamic</span><span class="o">&gt;&gt;</span><span class="p">();</span>
</code></pre></div>

<div class="admonition tip">
<p class="admonition-title">Inferred Types</p>
<p>You don't need to provide a type argument to <code>as</code> or <code>decode</code> if the type can be inferred. For example, <code>object.read(await request.body.decode())</code> will infer the type of the decoded body as a <code>Map&lt;String, dynamic&gt;</code> without having to provide type parameters.</p>
</div>
<p>If a body cannot be decoded according to its content-type (the data is malformed), an error is thrown that sends the appropriate error response to the client.</p>
<p>For more request body behavior, see the API reference for <code>RequestBody</code>, the <a href="../resource_controller/">section on body binding for ResourceControllers</a> and a later section in this guide on <code>Serializable</code>.</p>
<div class="admonition note">
<p class="admonition-title">Max Body Size</p>
<p>The size of a request body is limited to 10MB by default and can be changed by setting the value of <code>RequestBody.maxSize</code> during application initialization.</p>
</div>
<h3 id="encoding-response-body-objects">Encoding Response Body Objects</h3>
<p>An HTTP response often contains a <em>body</em>. For example, the body in response to <code>GET /users/1</code> might be JSON object that represents a user. To ensure the client understands that the body is a JSON object, it includes the header <code>Content-Type: application/json; charset=utf-8</code>.</p>
<p>When creating a <code>Response</code> that has a body, you provide a <em>body object</em> and a <code>contentType</code>. For example:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">var</span> <span class="n">map</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;value&quot;</span><span class="p">};</span>

<span class="c1">// ContentType.json is the default, setting it may be omitted.</span>
<span class="c1">// ContentType.json == `application/json; charset=utf-8&#39;</span>
<span class="kd">final</span> <span class="n">response</span> <span class="o">=</span> <span class="n">Response</span><span class="p">.</span><span class="n">ok</span><span class="p">(</span><span class="n">map</span><span class="p">)</span>
  <span class="p">..</span><span class="n">contentType</span> <span class="o">=</span> <span class="n">ContentType</span><span class="p">.</span><span class="n">json</span><span class="p">;</span>
</code></pre></div>

<p>Body objects are encoded according to their content-type. In the above, <code>map</code> is first encoded as a JSON string and then to a list of UTF8 bytes.</p>
<p><img alt="Map Encoding" src="../../img/object_body_flow.png" /></p>
<p>A <code>ContentType</code> is made up of three components: a primary type, a subtype and an optional character set.</p>
<p><img alt="Content Type Components" src="../../img/content_type_components.png" /></p>
<p>The primary and subtype determine the first conversion step and the charset determines the next. Each step is performed by an instance of <code>Codec</code> (from <code>dart:convert</code>). For example, the content type <code>application/json</code> selects <code>JsonCodec</code>, while charset <code>utf-8</code> selects <code>Utf8Codec</code>. These two codecs are run in succession to convert the <code>Map</code> to a list of bytes. The codec is selected by your application's <code>CodecRegistry</code>; this is covered in later section.</p>
<p>The body object must be valid for the selected codec. In the above example, a <code>Map&lt;String, dynamic&gt;</code> can be encoded by a <code>JsonCodec</code>. But if the body object cannot be encoded, a 500 Server Error response is sent. A valid input for one <code>Codec</code> may not be valid for another; it is up to you to ensure that the body object is valid for the <code>contentType</code> of the response.</p>
<p>Not all content types require two conversion steps. For example, when serving an HTML file, the body object is already an HTML <code>String</code>. It will only be converted by a charset encoder:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">var</span> <span class="n">html</span> <span class="o">=</span> <span class="s2">&quot;&lt;html&gt;&lt;/html&gt;&quot;</span><span class="p">;</span>
<span class="kd">var</span> <span class="n">response</span> <span class="o">=</span> <span class="n">Response</span><span class="p">.</span><span class="n">ok</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
  <span class="p">..</span><span class="n">contentType</span> <span class="o">=</span> <span class="n">ContentType</span><span class="p">.</span><span class="n">html</span><span class="p">;</span>
</code></pre></div>

<p>And an image body object needs no conversion at all, since it is already a list of bytes. If there is no registered codec for a content-type, the body object must be a byte array (<code>List&lt;int&gt;</code> where each value is between 0-255).</p>
<div class="codehilite"><pre><span></span><code><span class="kd">final</span> <span class="n">imageFile</span> <span class="o">=</span> <span class="n">File</span><span class="p">(</span><span class="s2">&quot;image.jpg&quot;</span><span class="p">);</span>
<span class="kd">final</span> <span class="n">imageBytes</span> <span class="o">=</span> <span class="kd">await</span> <span class="n">imageFile</span><span class="p">.</span><span class="n">readAsBytes</span><span class="p">();</span>
<span class="kd">final</span> <span class="n">response</span> <span class="o">=</span> <span class="n">Response</span><span class="p">.</span><span class="n">ok</span><span class="p">(</span><span class="n">imageBytes</span><span class="p">)</span>
  <span class="p">..</span><span class="n">contentType</span> <span class="o">=</span> <span class="n">ContentType</span><span class="p">(</span><span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="s2">&quot;jpeg&quot;</span><span class="p">);</span>
</code></pre></div>

<p>You may disable the automatic encoding of a body as long as the body object is a byte array:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">final</span> <span class="n">jsonBytes</span> <span class="o">=</span> <span class="n">utf8</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="n">encode</span><span class="p">({</span><span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;value&quot;</span><span class="p">}));</span>
<span class="kd">final</span> <span class="n">response</span> <span class="o">=</span> <span class="n">Response</span><span class="p">.</span><span class="n">ok</span><span class="p">(</span><span class="n">jsonBytes</span><span class="p">)..</span><span class="n">encodeBody</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</code></pre></div>

<p>See a later section for more details on content type to codec mappings. Also, see the documentation for <code>CodecRegistry</code> for details on built-in codecs and adding codecs.</p>
<h3 id="streaming-response-bodies">Streaming Response Bodies</h3>
<p>A body object may also be a <code>Stream&lt;T&gt;</code>. <code>Stream&lt;T&gt;</code> body objects are most often used when serving files. This allows the contents of the file to be streamed from disk to the HTTP client without having to load the whole file into memory first. (See also <code>FileController</code>.)</p>
<div class="codehilite"><pre><span></span><code><span class="kd">final</span> <span class="n">imageFile</span> <span class="o">=</span> <span class="n">File</span><span class="p">(</span><span class="s2">&quot;image.jpg&quot;</span><span class="p">);</span>
<span class="kd">final</span> <span class="n">imageByteStream</span> <span class="o">=</span> <span class="n">imageFile</span><span class="p">.</span><span class="n">openRead</span><span class="p">();</span>
<span class="kd">final</span> <span class="n">response</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Response</span><span class="p">.</span><span class="n">ok</span><span class="p">(</span><span class="n">imageByteStream</span><span class="p">)</span>
  <span class="p">..</span><span class="n">contentType</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ContentType</span><span class="p">(</span><span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="s2">&quot;jpeg&quot;</span><span class="p">);</span>
</code></pre></div>

<p>When a body object is a <code>Stream&lt;T&gt;</code>, the response will not be sent until the stream is closed. For finite streams - like those from opened filed - this happens as soon as the entire file is read. For streams that you construct yourself, you must close the stream some time after the response has been returned.</p>
<h2 id="codecs-and-content-types">Codecs and Content Types</h2>
<p>In the above sections, we glossed over how a codec gets selected when preparing the response body. The common case of <code>ManagedObject&lt;T&gt;</code> body objects that are sent as UTF8 encoded JSON 'just works' and is suitable for most applications. When serving assets for a web application or different data formats like XML, it becomes important to understand how Aqueduct's codec registry works.</p>
<p><code>CodecRegistry</code> contains mappings from content types to <code>Codec</code>s. These codecs encode response bodies and decode request bodies. There are three built-in codecs for <code>application/json</code>, <code>application/x-www-form-urlencoded</code> and <code>text/*</code>. When a response is being sent, the repository is searched for an entry that exactly matches the primary and subtype of the <code>Response.contentType</code>. If an entry exists, the associated <code>Codec</code> starts the conversion. For example, if the content type is <code>application/json; charset=utf-8</code>, the built-in <code>application/json</code> codec encodes the body object.</p>
<p>If there isn't an exact match, but there is an entry for the primary type with the wildcard (<code>*</code>) subtype, that codec is used. For example, the built-in codec for <code>text/*</code> will be selected for both <code>text/plain</code> and <code>text/html</code>. If there was something special that had to be done for <code>text/html</code>, a more specific codec may be added for that type:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">class</span> <span class="nc">MyChannel</span> <span class="kd">extends</span> <span class="n">ApplicationChannel</span> <span class="p">{</span>
  <span class="nd">@override</span>
  <span class="n">Future</span> <span class="n">prepare</span><span class="p">()</span> <span class="kd">async</span> <span class="p">{</span>
    <span class="n">CodecRegistry</span><span class="p">.</span><span class="n">defaultInstance</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">ContentType</span><span class="p">(</span><span class="s2">&quot;application&quot;</span><span class="p">,</span> <span class="s2">&quot;html&quot;</span><span class="p">),</span> <span class="n">HTMLCodec</span><span class="p">());</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>Codecs must be added in your <code>ApplicationChannel.prepare</code> method. The codec must implement <code>Codec</code> from <code>dart:convert</code>. In the above example, when a response's content type is <code>text/html</code>, the <code>HTMLCodec</code> will encode the body object. This codec takes precedence over <code>text/*</code> because it is more specific.</p>
<p>When selecting a codec for a response body, the <code>ContentType.charset</code> doesn't impact which codec is selected. If a response's content-type has a charset, then a charset encoder like <code>UTF8</code> will be applied as a last encoding step. For example, a response with content-type <code>application/json; charset=utf-8</code> will encode the body object as a JSON string, which is then encoded as a list of UTF8 bytes. It is required that a response body's eventually encoded type is a list of bytes, so it follows that a codec that produces a string must have a charset.</p>
<p>If there is no codec in the repository for the content type of a <code>Response</code>, the body object must be a <code>List&lt;int&gt;</code> or <code>Stream&lt;List&lt;int&gt;&gt;</code>. If you find yourself converting data prior to setting it as a body object, it may make sense to add your own codec to <code>CodecRegistry</code>.</p>
<p>A request's body always starts as a list of bytes and is decoded into Dart objects. To decode a JSON request body, it first must be decoded from the list of UTF8 bytes into a string. It is possible that a client could omit the charset in its content-type header. Codecs added to <code>CodecRegistry</code> may specify a default charset to interpret a charset-less content-type. When a codec is added to the repository, if content-type's charset is non-null, that is the default. For example, the JSON codec is added like this:</p>
<div class="codehilite"><pre><span></span><code><span class="n">CodecRegistry</span><span class="p">.</span><span class="n">defaultInstance</span><span class="p">.</span><span class="n">add</span><span class="p">(</span>
  <span class="n">ContentType</span><span class="p">(</span><span class="s2">&quot;application&quot;</span><span class="p">,</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span> <span class="nl">charset:</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">),</span>
  <span class="k">const</span> <span class="n">JsonCodec</span><span class="p">(),</span>
  <span class="nl">allowCompression:</span> <span class="kc">true</span><span class="p">);</span>
</code></pre></div>

<p>If no charset is specified when registering a codec, no charset decoding occurs on a request body if one doesn't exist. Content-types that are decoded from a <code>String</code> should not use a default charset because the repository would always attempt to decode the body as a string first.</p>
<h3 id="compression-with-gzip">Compression with gzip</h3>
<p>Body objects may be compressed with <code>gzip</code> if the HTTP client allows it <em>and</em> the <code>CodecRegistry</code> has been configured to compress the content type of the response. The three built-in codecs - <code>application/json</code>, <code>application/x-www-form-urlencoded</code> and <code>text/*</code> - are all configured to allow compression. Compression occurs as the last step of conversion and only if the HTTP client sends the <code>Accept-Encoding: gzip</code> header.</p>
<p>Content types that are not in the codec repository will not trigger compression, even if the HTTP client allows compression with the <code>Accept-Encoding</code> header. This is to prevent binary contents like images from being 'compressed', since they are likely already compressed by a content-specific algorithm. In order for Aqueduct to compress a content type other than the built-in types, you may add a codec to the repository with the <code>allowCompression</code> flag. (The default value is <code>true</code>.)</p>
<div class="codehilite"><pre><span></span><code><span class="n">CodecRegistry</span><span class="p">.</span><span class="n">add</span><span class="p">(</span>
  <span class="n">ContentType</span><span class="p">(</span><span class="s2">&quot;application&quot;</span><span class="p">,</span> <span class="s2">&quot;x-special&quot;</span><span class="p">),</span>
   <span class="n">MyCodec</span><span class="p">(),</span>
  <span class="nl">allowCompression:</span> <span class="kc">true</span><span class="p">);</span>
</code></pre></div>

<p>You may also set whether or not a content type uses compression without having to specify a codec if no conversion step needs to occur:</p>
<div class="codehilite"><pre><span></span><code><span class="n">CodecRegistry</span><span class="p">.</span><span class="n">setAllowsCompression</span><span class="p">(</span><span class="k">new</span> <span class="n">ContentType</span><span class="p">(</span><span class="s2">&quot;application&quot;</span><span class="p">,</span> <span class="s2">&quot;x-special&quot;</span><span class="p">),</span> <span class="kc">true</span><span class="p">);</span>
</code></pre></div>

<h2 id="serializable-objects">Serializable Objects</h2>
<p>Most request and response bodies are JSON objects and lists of objects. In Dart, JSON objects are maps. A <code>Serializable</code> object can be read from a map and converted back into a map. You subclass <code>Serializable</code> to assign keys from a map to properties of a your subclass, and to write its properties back to a map. This allows static types you declare in your application to represent expected request and response bodies. Aqueduct's ORM type <code>ManagedObject</code> is a <code>Serializable</code>, for example.</p>
<h3 id="sending-serializable-objects-as-response-bodies">Sending Serializable Objects as Response Bodies</h3>
<p>The body object of a response can be a <code>Serializable</code>. Before the response is sent, <code>asMap()</code> is called before the body object is encoded into JSON (or some other transmission format).</p>
<p>For example, a single serializable object returned in a 200 OK response:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">final</span> <span class="n">query</span> <span class="o">=</span> <span class="n">Query</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span><span class="p">(</span><span class="n">context</span><span class="p">)..</span><span class="n">where</span><span class="p">((</span><span class="n">p</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">p</span><span class="p">.</span><span class="n">id</span><span class="p">).</span><span class="n">equalTo</span><span class="p">(</span><span class="m">1</span><span class="p">);</span>
<span class="kd">final</span> <span class="n">person</span> <span class="o">=</span> <span class="kd">await</span> <span class="n">query</span><span class="p">.</span><span class="n">fetchOne</span><span class="p">();</span>
<span class="kd">final</span> <span class="n">response</span> <span class="o">=</span> <span class="n">Response</span><span class="p">.</span><span class="n">ok</span><span class="p">(</span><span class="n">person</span><span class="p">);</span>
</code></pre></div>

<p>A response body object can also be a list of <code>Serializable</code> objects.</p>
<div class="codehilite"><pre><span></span><code><span class="kd">final</span> <span class="n">query</span> <span class="o">=</span> <span class="n">Query</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span><span class="p">(</span><span class="n">context</span><span class="p">);</span>
<span class="kd">final</span> <span class="n">people</span> <span class="o">=</span> <span class="kd">await</span> <span class="n">query</span><span class="p">.</span><span class="n">fetch</span><span class="p">();</span>
<span class="kd">final</span> <span class="n">response</span> <span class="o">=</span> <span class="n">Response</span><span class="p">.</span><span class="n">ok</span><span class="p">(</span><span class="n">people</span><span class="p">);</span>
</code></pre></div>

<p>The flow of a body object is shown in the following diagram. Each orange item is an allowed body object type and shows the steps it will go through when being encoded to the HTTP response body. For example, a <code>Serializable</code> goes through three steps, whereas a <code>List&lt;int&gt;</code> goes through zero steps and is added as-is to the HTTP response.</p>
<p><img alt="Response Body Object Flow" src="../../img/response_flow.png" /></p>
<h3 id="reading-serializable-objects-from-request-bodies">Reading Serializable Objects from Request Bodies</h3>
<p>A serializable object can be read from a request body:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">final</span> <span class="n">person</span> <span class="o">=</span> <span class="n">Person</span><span class="p">()..</span><span class="n">read</span><span class="p">(</span><span class="kd">await</span> <span class="n">request</span><span class="p">.</span><span class="n">body</span><span class="p">.</span><span class="n">decode</span><span class="p">());</span>
</code></pre></div>

<p>A list of serializable objects as well:</p>
<div class="codehilite"><pre><span></span><code><span class="n">List</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span> <span class="kt">dynamic</span><span class="o">&gt;&gt;</span> <span class="n">objects</span> <span class="o">=</span> <span class="kd">await</span> <span class="n">request</span><span class="p">.</span><span class="n">body</span><span class="p">.</span><span class="n">decode</span><span class="p">();</span>
<span class="kd">final</span> <span class="n">people</span> <span class="o">=</span> <span class="n">objects</span><span class="p">.</span><span class="n">map</span><span class="p">((</span><span class="n">o</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">Person</span><span class="p">()..</span><span class="n">read</span><span class="p">(</span><span class="n">o</span><span class="p">)).</span><span class="n">toList</span><span class="p">();</span>
</code></pre></div>

<p>Both serializable and a list of serializable can be <a href="../resource_controller/">bound to a operation method parameter in a ResourceController</a>.</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Operation</span><span class="p">.</span><span class="n">post</span><span class="p">()</span>
<span class="n">Future</span><span class="o">&lt;</span><span class="n">Response</span><span class="o">&gt;</span> <span class="n">addPerson</span><span class="p">(</span><span class="nd">@Bind</span><span class="p">.</span><span class="n">body</span><span class="p">()</span> <span class="n">Person</span> <span class="n">person</span><span class="p">)</span> <span class="kd">async</span> <span class="p">{</span>
  <span class="kd">final</span> <span class="n">insertedPerson</span> <span class="o">=</span> <span class="kd">await</span> <span class="n">context</span><span class="p">.</span><span class="n">insertObject</span><span class="p">(</span><span class="n">person</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">Response</span><span class="p">.</span><span class="n">ok</span><span class="p">(</span><span class="n">insertedPerson</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="key-filtering">Key Filtering</h4>
<p>Both <code>read</code> and <code>Bind.body</code> (when binding a <code>Serializable</code>) support key filtering. A key filter is a list of keys that either discard keys from the body, requires keys in the body, or throws an error if a key exists in the body. Example:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">final</span> <span class="n">person</span> <span class="o">=</span> <span class="n">Person</span><span class="p">()</span>
  <span class="p">..</span><span class="n">read</span><span class="p">(</span><span class="kd">await</span> <span class="n">request</span><span class="p">.</span><span class="n">body</span><span class="p">.</span><span class="n">decode</span><span class="p">(),</span>
         <span class="nl">ignore:</span> <span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
         <span class="nl">reject:</span> <span class="p">[</span><span class="s2">&quot;password&quot;</span><span class="p">],</span>
         <span class="nl">require:</span> <span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;height&quot;</span><span class="p">,</span> <span class="s2">&quot;weight&quot;</span><span class="p">]);</span>
</code></pre></div>

<p>In the above: if the body contains 'id', the value is discarded immediately; if the body contains 'password', a 400 status code exception is thrown; and if the body doesn't contain all of name, height and weight, a 400 status code exception is thrown.</p>
<p>When binding a list of serializables, filters are applied to each element of the list.</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Operation</span><span class="p">.</span><span class="n">post</span><span class="p">()</span>
<span class="n">Future</span><span class="o">&lt;</span><span class="n">Response</span><span class="o">&gt;</span> <span class="n">addPerson</span><span class="p">(</span><span class="nd">@Bind</span><span class="p">.</span><span class="n">body</span><span class="p">(</span><span class="nl">reject:</span> <span class="p">[</span><span class="s2">&quot;privateInfo&quot;</span><span class="p">])</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span> <span class="n">people</span><span class="p">)</span> <span class="kd">async</span> <span class="p">{</span>
  <span class="c1">// if any Person in the body contains the privateInfo key, a 400 Bad Request is sent and this method</span>
  <span class="c1">// is not called</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="subclassing-serializable">Subclassing Serializable</h3>
<p>A <code>Serializable</code> object must implement a <code>readFromMap()</code> and <code>asMap()</code>.</p>
<p>An object that extends <code>Serializable</code> may be used as a response body object directly:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">class</span> <span class="nc">Person</span> <span class="kd">extends</span> <span class="n">Serializable</span> <span class="p">{</span>
  <span class="kt">String</span> <span class="n">name</span><span class="p">;</span>
  <span class="kt">String</span> <span class="n">email</span><span class="p">;</span>

  <span class="n">Map</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span> <span class="kt">dynamic</span><span class="o">&gt;</span> <span class="n">asMap</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="n">name</span><span class="p">,</span>
      <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="n">email</span>
    <span class="p">};</span>
  <span class="p">}</span>

  <span class="kt">void</span> <span class="n">readFromMap</span><span class="p">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span> <span class="kt">dynamic</span><span class="o">&gt;</span> <span class="n">inputMap</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">inputMap</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">];</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">inputMap</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">];</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">final</span> <span class="n">person</span> <span class="o">=</span> <span class="n">Person</span><span class="p">();</span>
<span class="kd">final</span> <span class="n">response</span> <span class="o">=</span> <span class="n">Response</span><span class="p">.</span><span class="n">ok</span><span class="p">(</span><span class="n">person</span><span class="p">);</span>
</code></pre></div>

<p><code>readFromMap</code> is invoked by <code>read</code>, after all filters have been applied.</p>
<h3 id="serializable-and-openapi-generation">Serializable and OpenAPI Generation</h3>
<p>See the section on how <code>Serializable</code> types work with OpenAPI documentation generation <a href="../../openapi/components/">here</a>.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        <a href="../controller/" class="md-footer__link md-footer__link--prev" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Handling Requests and Sending Response
            </div>
          </div>
        </a>
      
      
        <a href="../routing/" class="md-footer__link md-footer__link--next" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Routing
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Built by Stable Kernel
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../../assets/javascripts/workers/search.fb4a9340.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.a1c7c35e.min.js"></script>
      
    
  </body>
</html>